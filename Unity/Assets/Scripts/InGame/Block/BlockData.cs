using UnityEngine;

public class BlockData : MonoBehaviour
{
    public BlockSO blockSO;

    // ???: ?????? id (-1 = ????? ?? ??)
    public int ownerId = -1;

    // ????? ?????? ??????? ?? ??
    public string BlockName => blockSO != null ? blockSO.Block_name : "";
    public int Price => blockSO != null ? blockSO.Block_price : 0;

    // ????? : ??? ?????? 20% (????? BlockSO?? ???? ??? ????? ??)
    public int Toll => Mathf.RoundToInt(Price * 0.2f);

    public GameObject buildingPrefab;      // ?? ??? ???? ??? ??????
    public Transform buildingSpawnPoint;   // ??? ??? ???
    private GameObject spawnedBuilding;    // ?????? ?????? ???

    // ?? ???: Y?????? ???? ?????
    public float buildingHeightOffset = 0.2f;

    public void BuildHouse(Color ownerColor)
    {
        if (buildingPrefab == null || buildingSpawnPoint == null)
        {
            Debug.LogWarning($"{BlockName} ??? ??????/???? ??????? ??????? ???? ????");
            return;
        }

        if (spawnedBuilding == null)
        {
            // ???????? ????? ???? ???
            Quaternion rot = buildingPrefab.transform.rotation;

            // ?? ???? ????????? ???? buildingHeightOffset ??? ?¡À??? ????
            Vector3 spawnPos = buildingSpawnPoint.position
                               + Vector3.up * buildingHeightOffset;

            spawnedBuilding = Instantiate(buildingPrefab,
                                          spawnPos,
                                          rot);

            var rend = spawnedBuilding.GetComponentInChildren<Renderer>();
            if (rend != null)
                rend.material.color = ownerColor;
        }
    }

    private void Awake()
    {
        // 1) ?¥í???????? ?? ???????, ??? ?? "HousePoint"?? ???? ??????.
        if (buildingSpawnPoint == null)
        {
            Transform t = transform.Find("HousePoint");
            if (t != null)
                buildingSpawnPoint = t;
        }

        // 2) ?? ??? ??? ???? X
        if (buildingSpawnPoint == null)
        {
            Debug.LogWarning($"{BlockName} : buildingSpawnPoint?? ??????? ???? ??????.");
        }
    }
}
